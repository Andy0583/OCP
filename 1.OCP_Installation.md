### 建置Master * 4 + Worker * 4
> 規格：4 core / 8GB Mem / 100GB HD(Thin)
> 需紀錄網卡 Mac address
> 設定每台VM EnableUUID（如下）
```
1.Open the Host Client, and log in to the ESXi.
2.Locate the Windows Server 2016 virtual machine for which you are enabling the disk UUID attribute, and power off the virtual machine.
3.After power-off, right-click the virtual machine, and choose Edit Settings.
4.Click VM Options tab, and select Advanced.
5.Click Edit Configuration in Configuration Parameters.
6.Click Add parameter.
7.In the Key column, type disk.EnableUUID.
8.In the Value column, type TRUE.
9.Click OK and click Save.
```

### 設定Redhat Console
```
1.Create Clasrer
2.Select "Datacenter" and "Bare Metal (x86_64)"
3.Select "Interactive"
4.Enter Cluster Name：ocp / Base domain：andy.com / OpenShift version：4.18.11 / Hosts' network configuration：Static IP
5.Enter DNS / Machine network(網段非IP) / Default gateway
6.Enter VM Mac address
7.Not selected Operators
8.Select "Add Host" - "Full Image" - Paste SSH public key - Generate Discovery ISO
9.Download Discovery ISO
10.Start VM using ISO
```

###關閉防火牆
```
[root@bastion ~]# systemctl stop firewalld

[root@bastion ~]# systemctl disable firewalld
Removed "/etc/systemd/system/multi-user.target.wants/firewalld.service".
Removed "/etc/systemd/system/dbus-org.fedoraproject.FirewallD1.service".

[root@bastion ~]# setenforce 0

[root@bastion ~]# sed -i 's/enforcing/disabled/' /etc/selinux/config
```

### 安裝Bind
```
[root@bastion ~]# yum install bind bind-utils -y
Red Hat Enterprise Linux 9 - BaseOS
.......略........
Complete!

[root@bastion ~]# vi /etc/named.conf
options {
        listen-on port 53 { any; };
#       listen-on-v6 port 53 { ::1; };
        allow-query     { any; };
        forwarders { 8.8.8.8; };
        dnssec-enable no;
        dnssec-validation no;
zone "ocp.andy.com" IN {
        type master;
        file "named.ocp.andy.com";
};

zone "25.12.172.in-addr.arpa" IN {
        type master;
        file "rev.25.12.172";
};
```
```
[root@bastion ~]# vi /var/named/named.ocp.andy.com
$TTL 1D
@       IN SOA  @ bastion.ocp.andy.com. (
                                        2020040819      ; serial
                                        3H      ; refresh
                                        15M     ; retry
                                        1W      ; expire
                                        1D )    ; minimum
@       IN NS   bastion.ocp.andy.com.
@       IN A    172.12.25.41
bastion         IN      A       172.12.25.41
master-1        IN      A       172.12.25.42
master-2        IN      A       172.12.25.43
master-3        IN      A       172.12.25.44
worker-1        IN      A       172.12.25.45
worker-2        IN      A       172.12.25.46
worker-3        IN      A       172.12.25.47
api             IN      A       172.12.25.48
*.apps          IN      A       172.12.25.49
```
```
[root@bastion ~]# vi /var/named/rev.25.12.172
$TTL 1D
@       IN SOA  @ bastion.ocp.andy.com. (
                                        2020040819      ; serial
                                        1D      ; refresh
                                        1H      ; retry
                                        1W      ; expire
                                        3H )    ; minimum
@       IN NS   bastion.ocp.andy.com.
25.12.172.in-addr.arpa      IN      PTR     bastion.ocp.andy.com
41   IN      PTR     bastion.ocp.andy.com.
42   IN      PTR     master-1.ocp.andy.com.
43   IN      PTR     master-2.ocp.andy.com.
44   IN      PTR     master-3.ocp.andy.com.
45   IN      PTR     worker-1.ocp.andy.com.
46   IN      PTR     worker-2.ocp.andy.com.
47   IN      PTR     worker-3.ocp.andy.com.
48   IN      PTR     api.ocp.andy.com.
49   IN      PTR     apps.ocp.andy.com.
```
```
[root@bastion ~]# chgrp named /var/named/named.ocp.andy.com

[root@bastion ~]# chmod 640 /var/named/named.ocp.andy.com

[root@bastion ~]# chgrp named /var/named/rev.25.12.172

[root@bastion ~]# chmod 640 /var/named/rev.25.12.172

[root@bastion ~]# systemctl enable named
Created symlink /etc/systemd/system/multi-user.target.wants/named.service → /usr/lib/systemd/system/named.service.

[root@bastion ~]# systemctl start named

[root@bastion ~]# systemctl status named
● named.service - Berkeley Internet Name Domain (DNS)
     Loaded: loaded (/usr/lib/systemd/system/named.service; enabled; vendor preset: disabled)
     Active: active (running) since Fri 2025-05-09 16:42:12 CST; 4s ago
    Process: 36786 ExecStartPre=/bin/bash -c if [ ! "$DISABLE_ZONE_CHECKING" == "yes" ]; then /usr/sbin/named-checkconf -z "$NAMED>
    Process: 36789 ExecStart=/usr/sbin/named -u named -c ${NAMEDCONF} $OPTIONS (code=exited, status=0/SUCCESS)
.......略........
```

### 產生SSH
```
[root@bastion ~]# ssh-keygen -t rsa -b 4096 -N '' -f ~/.ssh/id_rsa
Generating public/private rsa key pair.
Created directory '/root/.ssh'.
Your identification has been saved in /root/.ssh/id_rsa
Your public key has been saved in /root/.ssh/id_rsa.pub
The key fingerprint is:
SHA256:rW2mrwax/1k3Fh6R20SyeM+mGeYVeMc+9CX2sj720bM root@bastion
The key's randomart image is:
+---[RSA 4096]----+
|              . .|
|             ..* |
|            ..B+=|
|      .  .   oo@=|
|       oS .   B.X|
|      o  o   + @o|
|       o. + . Xo.|
|        o+ o +o.+|
|       .o++  ..E.|
+----[SHA256]-----+

[root@bastion ~]# eval "$(ssh-agent -s)"
Agent pid 36820

[root@bastion ~]# ssh-add ~/.ssh/id_rsa
Identity added: /root/.ssh/id_rsa (root@bastion)

[root@bastion ~]# cat /root/.ssh/id_rsa.pub
ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAACAQDM2xUFcTq2jLrf8/K7x0sryZKfDPgUiu/E4sTqdiG/D+uj4mjt4I4qGUaXhHrM1SAp1FeugbwpOw7bfqX1oUwDBgB5NpLnowk/hpEVorpSKcK7X7zPwpXIfYvz2uzlVUnTWKRpbv397BP+AmMzb7yKkvhhuZLGote3qQcEgrm60IyW9KSTRXg+8NhJr3SWRGYRHmzMAUFr8ifjevTihD9S2p2WmjJ3KUmnDi1RXedE5+faLvDihJqg882dX/yQK6JZSvmPQyhW8x51nxdIfJPQ3U4A0y7+n07l1CmAORa4NBm5zHrKnmIz0mltX9D0w5cMtSlXfh+E1OaE4z1d4ZDP+L98+9zu19Zl2Rfwzg3aEFKhCSZ7H1f1BwnlDgdunS5er6DH/1Uuw99w0uZ0LYfXFoBPSACisxnsGZrV7mH9/Sjwt1pd5MtxytTagnWAKEjxGxFknjr0/nG8fcffR8u6C6Wkoei6nccHzF10h3Jl9yWnbIwEpTTBc0W/rKUcL2TUJq4d3mNdBJzSm2NtJmj47N8QBgL2iaixipwMpj1HfoLubExgwq06gH00tuN1J0fUYClIb71PyU2C/g5XyvMOBg29JTPYFssD223ASJ8mldKPTnQuwLc9TlgYtnTgAtYxamhAY9GPKGNYl5RxBrpGHvgMOT84FAMpm/ETHGVnpQ== root@bastion
```
